!function(e){e.fn.extend({lyPazzle:function(t,n,a){var i=e(this);i.addClass("ly_pazzle");for(var s=new Array(n),r=[],l=0;n>l;l++)s[l]=new Array(t);var d={addData:function(e,t,n,a,i){var l;if(i){var d=[];for(l=0;l<a.length;l++)if(d.push(t),t>n)s[e][t]=a.substr(l,1),t--;else{if(!(n>t)){s[e][t]=a.substr(l,1);break}s[e][t]=a.substr(l,1),t++}r.push({y:e,x:d})}else{var h=[];for(l=0;l<a.length;l++)if(h.push(t),t>n)s[t][e]=a.substr(l,1),t--;else{if(!(n>t)){s[t][e]=a.substr(l,1);break}s[t][e]=a.substr(l,1),t++}r.push({y:h,x:e})}},initDate:function(){for(var e=0;e<a.length;e++){var t=a[e].start,n=a[e].end;t[0]==n[0]?d.addData(t[0]-1,t[1]-1,n[1]-1,a[e].answer):t[1]==n[1]&&d.addData(t[1]-1,t[0]-1,n[0]-1,a[e].answer,!0)}},initHtml:function(){for(var a=0;n>a;a++){for(var r=e("<ul></ul>"),l=0;t>l;l++){var d=e('<input type="text" maxlength="1"/>');s[a][l]?d.data("answer",s[a][l]):d.attr("disabled","disabled"),r.append(d)}i.append(r)}},initAction:function(){i.children("ul").each(function(t){e(this).children("input").each(function(t){e(this).keyup(function(n){var a=e(this),i=a.parent();n.keyCode>64&&n.keyCode<91||n.keyCode>47&&n.keyCode<58||n.keyCode>95&&n.keyCode<106?"disabled"!=a.next().attr("disabled")?a.next().focus():i.next().children("input").eq(t).focus():38==n.keyCode?i.prev().children("input").eq(t).focus().select():40==n.keyCode?i.next().children("input").eq(t).focus().select():37==n.keyCode?"disabled"!=a.prev().attr("disabled")&&a.prev().focus().select():39==n.keyCode&&"disabled"!=a.next().attr("disabled")&&a.next().focus().select()})})})}};d.initDate(),d.initHtml(),d.initAction();var h={showAnswer:function(){i.hasClass("ly_pazzle")&&i.find("input.on").each(function(){e(this).html(e(this).data("answer")).attr("contenteditable","false")})},checkAnswer:function(){i.hasClass("ly_pazzle")&&i.find("input.on").each(function(){e(this).html()==e(this).data("answer")?e(this).addClass("right"):e(this).addClass("wrong")})},refresh:function(){i.find("input.on").html("").attr({"class":"on",contenteditable:"true"})},readFn:function(){var t=[];return i.children("ul").each(function(){var n=[];e(this).children("input").each(function(){e(this).hasClass("on")?n.push(e(this).html()):n.push("")}),t.push(n)}),JSON.stringify(t)},setFn:function(t){var n=JSON.parse(t);i.children("ul").each(function(t){e(this).children("input").each(function(a){e(this).hasClass("on")&&e(this).html(n[t][a])})})},checkFn:function(e){for(var t,n,a=JSON.parse(e),s=[],l=0;l<r.length;l++){var d=1,h=0,c=r[l].x,u=r[l].y;if(c instanceof Array){n=u;var o=i.children().eq(n);for(h=0;h<c.length;h++)if(t=c[h],o.children().eq(t).data("answer")!=a[n][t]){d=0;break}}else for(t=c,h=0;h<u.length;h++)if(n=u[h],i.children().eq(n).children().eq(t).data("answer")!=a[n][t]){d=0;break}s.push(d)}return JSON.stringify(s)}};return h}})}(jQuery);